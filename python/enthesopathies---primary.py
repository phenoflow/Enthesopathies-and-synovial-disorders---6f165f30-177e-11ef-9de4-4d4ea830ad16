# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2024.

import sys, csv, re

codes = [{"code":"9628.0","system":"readv2"},{"code":"67879.0","system":"readv2"},{"code":"6089.0","system":"readv2"},{"code":"24149.0","system":"readv2"},{"code":"360.0","system":"readv2"},{"code":"20427.0","system":"readv2"},{"code":"66768.0","system":"readv2"},{"code":"49630.0","system":"readv2"},{"code":"1013.0","system":"readv2"},{"code":"3546.0","system":"readv2"},{"code":"15150.0","system":"readv2"},{"code":"55423.0","system":"readv2"},{"code":"17129.0","system":"readv2"},{"code":"5337.0","system":"readv2"},{"code":"29426.0","system":"readv2"},{"code":"2695.0","system":"readv2"},{"code":"730.0","system":"readv2"},{"code":"9021.0","system":"readv2"},{"code":"28584.0","system":"readv2"},{"code":"14843.0","system":"readv2"},{"code":"64986.0","system":"readv2"},{"code":"56234.0","system":"readv2"},{"code":"60024.0","system":"readv2"},{"code":"17603.0","system":"readv2"},{"code":"45607.0","system":"readv2"},{"code":"8081.0","system":"readv2"},{"code":"16345.0","system":"readv2"},{"code":"38516.0","system":"readv2"},{"code":"10555.0","system":"readv2"},{"code":"17001.0","system":"readv2"},{"code":"94259.0","system":"readv2"},{"code":"22735.0","system":"readv2"},{"code":"955.0","system":"readv2"},{"code":"10457.0","system":"readv2"},{"code":"55428.0","system":"readv2"},{"code":"5569.0","system":"readv2"},{"code":"17994.0","system":"readv2"},{"code":"21994.0","system":"readv2"},{"code":"18609.0","system":"readv2"},{"code":"827.0","system":"readv2"},{"code":"106658.0","system":"readv2"},{"code":"17285.0","system":"readv2"},{"code":"12828.0","system":"readv2"},{"code":"36936.0","system":"readv2"},{"code":"59364.0","system":"readv2"},{"code":"11911.0","system":"readv2"},{"code":"24148.0","system":"readv2"},{"code":"20787.0","system":"readv2"},{"code":"54197.0","system":"readv2"},{"code":"16166.0","system":"readv2"},{"code":"1209.0","system":"readv2"},{"code":"3823.0","system":"readv2"},{"code":"17554.0","system":"readv2"},{"code":"4292.0","system":"readv2"},{"code":"2344.0","system":"readv2"},{"code":"24200.0","system":"readv2"},{"code":"12368.0","system":"readv2"},{"code":"4278.0","system":"readv2"},{"code":"1498.0","system":"readv2"},{"code":"32895.0","system":"readv2"},{"code":"1322.0","system":"readv2"},{"code":"27844.0","system":"readv2"},{"code":"36659.0","system":"readv2"},{"code":"2380.0","system":"readv2"},{"code":"37850.0","system":"readv2"},{"code":"6040.0","system":"readv2"},{"code":"3717.0","system":"readv2"},{"code":"8285.0","system":"readv2"},{"code":"20989.0","system":"readv2"},{"code":"16137.0","system":"readv2"},{"code":"57137.0","system":"readv2"},{"code":"32005.0","system":"readv2"},{"code":"18477.0","system":"readv2"},{"code":"7424.0","system":"readv2"},{"code":"11577.0","system":"readv2"},{"code":"17552.0","system":"readv2"},{"code":"69812.0","system":"readv2"},{"code":"35448.0","system":"readv2"},{"code":"4922.0","system":"readv2"},{"code":"16623.0","system":"readv2"},{"code":"38460.0","system":"readv2"},{"code":"18835.0","system":"readv2"},{"code":"67789.0","system":"readv2"},{"code":"5665.0","system":"readv2"},{"code":"101924.0","system":"readv2"},{"code":"18155.0","system":"readv2"},{"code":"5489.0","system":"readv2"},{"code":"1232.0","system":"readv2"},{"code":"9942.0","system":"readv2"},{"code":"1230.0","system":"readv2"},{"code":"3592.0","system":"readv2"},{"code":"5299.0","system":"readv2"},{"code":"11633.0","system":"readv2"},{"code":"4055.0","system":"readv2"},{"code":"12553.0","system":"readv2"},{"code":"40050.0","system":"readv2"},{"code":"3119.0","system":"readv2"},{"code":"17311.0","system":"readv2"},{"code":"8644.0","system":"readv2"},{"code":"4040.0","system":"readv2"},{"code":"35418.0","system":"readv2"},{"code":"45464.0","system":"readv2"},{"code":"1832.0","system":"readv2"},{"code":"52354.0","system":"readv2"},{"code":"48718.0","system":"readv2"},{"code":"29866.0","system":"readv2"},{"code":"35673.0","system":"readv2"},{"code":"27694.0","system":"readv2"},{"code":"1507.0","system":"readv2"},{"code":"43696.0","system":"readv2"},{"code":"14770.0","system":"readv2"},{"code":"4795.0","system":"readv2"},{"code":"20507.0","system":"readv2"},{"code":"8298.0","system":"readv2"},{"code":"16583.0","system":"readv2"},{"code":"38659.0","system":"readv2"},{"code":"7719.0","system":"readv2"},{"code":"17972.0","system":"readv2"},{"code":"104158.0","system":"readv2"},{"code":"50439.0","system":"readv2"},{"code":"7688.0","system":"readv2"},{"code":"16602.0","system":"readv2"},{"code":"49764.0","system":"readv2"},{"code":"30951.0","system":"readv2"},{"code":"874.0","system":"readv2"},{"code":"5647.0","system":"readv2"},{"code":"102873.0","system":"readv2"},{"code":"41938.0","system":"readv2"},{"code":"54684.0","system":"readv2"},{"code":"16601.0","system":"readv2"},{"code":"28211.0","system":"readv2"},{"code":"65588.0","system":"readv2"},{"code":"11898.0","system":"readv2"},{"code":"55448.0","system":"readv2"},{"code":"41562.0","system":"readv2"},{"code":"50350.0","system":"readv2"},{"code":"17066.0","system":"readv2"},{"code":"15401.0","system":"readv2"},{"code":"57379.0","system":"readv2"},{"code":"7293.0","system":"readv2"},{"code":"615.0","system":"readv2"},{"code":"21924.0","system":"readv2"},{"code":"12183.0","system":"readv2"},{"code":"43238.0","system":"readv2"},{"code":"42610.0","system":"readv2"},{"code":"552.0","system":"readv2"},{"code":"3664.0","system":"readv2"},{"code":"42895.0","system":"readv2"},{"code":"52121.0","system":"readv2"},{"code":"1505.0","system":"readv2"},{"code":"8949.0","system":"readv2"},{"code":"106916.0","system":"readv2"},{"code":"31974.0","system":"readv2"},{"code":"6824.0","system":"readv2"},{"code":"20087.0","system":"readv2"},{"code":"16984.0","system":"readv2"},{"code":"37100.0","system":"readv2"},{"code":"66299.0","system":"readv2"},{"code":"9601.0","system":"readv2"},{"code":"11569.0","system":"readv2"},{"code":"60221.0","system":"readv2"},{"code":"28401.0","system":"readv2"},{"code":"52110.0","system":"readv2"},{"code":"20524.0","system":"readv2"},{"code":"12136.0","system":"readv2"},{"code":"6686.0","system":"readv2"},{"code":"29661.0","system":"readv2"},{"code":"332.0","system":"readv2"},{"code":"62729.0","system":"readv2"},{"code":"24495.0","system":"readv2"},{"code":"14900.0","system":"readv2"},{"code":"4574.0","system":"readv2"},{"code":"10853.0","system":"readv2"},{"code":"725.0","system":"readv2"},{"code":"20147.0","system":"readv2"},{"code":"36547.0","system":"readv2"},{"code":"46384.0","system":"readv2"},{"code":"10810.0","system":"readv2"},{"code":"789.0","system":"readv2"},{"code":"58147.0","system":"readv2"},{"code":"4622.0","system":"readv2"},{"code":"4031.0","system":"readv2"},{"code":"100012.0","system":"readv2"},{"code":"864.0","system":"readv2"},{"code":"51366.0","system":"readv2"},{"code":"15130.0","system":"readv2"},{"code":"1726.0","system":"readv2"},{"code":"3820.0","system":"readv2"},{"code":"65065.0","system":"readv2"},{"code":"11479.0","system":"readv2"},{"code":"495.0","system":"readv2"},{"code":"89925.0","system":"readv2"},{"code":"24150.0","system":"readv2"},{"code":"40319.0","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('enthesopathies-and-synovial-disorders-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["enthesopathies---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["enthesopathies---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["enthesopathies---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
